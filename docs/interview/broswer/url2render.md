---
title: 从输入URL到页面渲染的过程
publish: true
date: 2021-04-24 10:00
categories:
 - 前端知识
tags:
 - 浏览器
author: maYunLaoXi
---

### 提问次数： 1

## 大至过程如下：

* 如果是搜索内容，地址栏会使用浏器。 默认的搜索引擎，来合成新的带搜索关键字的URL。

* 如果判断输入内容符合URL规则，比如输入的是 time.geekbang.org，那么地址栏会根据规则，把这段内容加上协议，合成为完整的URL，如 https://time.geekbang.org。
2.发送网络
    我们现在浏览器进程推进到网络进程，然后进行dns解析，获取到端口和ip 去建立tcp连接，然后他会去缓存看看有没有缓存，如果有，就从缓存中获取，如果没有就去请求服务器。
   请求回来后，他会检查请求头和状态吗如果是 301 他会去请求头拿Location字段里面读取重定向的地址，然后重定向到改地址。
如果不是状态码200就是一切正常，处理下面的逻辑。
 然后请求回来后，他会去检查contentType类型不同的属性
3.准备渲染进程
* 通常情况下，打开新的页面都会使用单独的渲染进程；
* 如果从A页面打开B页面，且A和B都属于同一站点的话，那么B页面复用A页面的渲染进程；如果是其他情况，浏览器进程则会为B创建一个新的渲染进程
4提交文档

首先要明确一点，这里的“文档”是指URL请求的响应体数据。
* “提交文档”的消息是由浏览器进程发出的，渲染进程接收到“提交文档”的消息后，会和网络进程建立传输数据的“管道”。
* 等文档数据传输完成之后，渲染进程会返回“确认提交”的消息给浏览器进程。
* 浏览器进程在收到“确认提交”的消息后，会更新浏览器界面状态，包括了安全状态、地址栏的URL、前进后退的历史状态，并更新Web页面。
* 只有上面的全部完成后，他才会替换页面
4.渲染
然后开始解析渲染页面

总结

* 用户输入url并回车
* 浏览器进程检查url，组装协议，构成完整的url
* 浏览器进程通过进程间通信（IPC）把url请求发送给网络进程
* 网络进程接收到url请求后检查本地缓存是否缓存了该请求资源，如果有则将该资源返回给浏览器进程
* 如果没有，网络进程向web服务器发起http请求（网络请求），请求流程如下：
    * 进行DNS解析，获取服务器ip地址，端口（端口是通过dns解析获取的吗？这里有个疑问）
    * 利用ip地址和服务器建立tcp连接
    * 构建请求头信息
    * 发送请求头信息
    * 服务器响应后，网络进程接收响应头和响应信息，并解析响应内容
* 网络进程解析响应流程；
    * 检查状态码，如果是301/302，则需要重定向，从Location自动中读取地址，重新进行第4步 （301/302跳转也会读取本地缓存吗？这里有个疑问），如果是200，则继续处理请求。
    * 200响应处理：检查响应类型Content-Type，如果是字节流类型，则将该请求提交给下载管理器，该导航流程结束，不再进行后续的渲染，如果是html则通知浏览器进程准备渲染进程准备进行渲染。
* 准备渲染进程
    * 浏览器进程检查当前url是否和之前打开的渲染进程根域名是否相同，如果相同，则复用原来的进程，如果不同，则开启新的渲染进程
* 传输数据、更新状态
    * 渲染进程准备好后，浏览器向渲染进程发起“提交文档”的消息，渲染进程接收到消息和网络进程建立传输数据的“管道”
    * 渲染进程接收完数据后，向浏览器发送“确认提交”
    * 浏览器进程接收到确认消息后更新浏览器界面状态：安全、地址栏url、前进后退的历史状态、更新web页面

## 回答思路

这个问题涉及到比较多的知识，关键要抓住核心的要点，把要点说全，然后稍加解析，思路清晰，不能拖沓。

1. 首先回答加载的流程，回答要点：
   * 浏览器跟椐DNS服务器得到域名的IP地址
   * 向这个IP的机器发送HTTP请求
   * 服务器收到并处理返回HTTP请求
   * 浏览器得到反回的内容
2. 稍加分析
   * 例如在浏览器输入www.baidu.com的时候，首先经过DNS解析得到对应的IP是102.xx.xxx.xx，然后向该IP发送HTTP请求
   * 服务器收到请求进行处理并反回，按照W3C的标准应该返回html格式的字符串浏览器才能解析成页面。
3. 接下来就渲染过程了
   * 根据HTML结构生成DOM树
   * 根据CSS生成CSSOM
   * 将DOM和CSSOM整合成renderTree
   * 根据renderTree开始渲染和展示
   * 遇到`<script>`时会执行并阻塞渲染
4. 加以分析
   * 浏览器拿到服务器反回的HTML内容，开始解析和渲染。最初拿到的是一堆字符串，必须结构化成DOM才能被浏览器识别（这个过程是一边下载一边解释）
   * 解析过程中，遇到`<link href="..">`或`<script src="..">`这种外链CSS或js，浏览器会停止解释而去执行下载和生成CSSOM或执行js代码完成后再继续解释。
   * 浏览器将CSS部分代码生成CSSOM，再将DOM和CSSOM合成renderTree，然后跟据renderTree渲染页面。
   * `为何CSS放在HTML的头部？` 这样会让浏览器尽早拿到CSS生成CSSOM，然后在解释HTML之后一次生成renderTree，渲染一次即可。
   * `为何script要放在HTML的底部？` 让浏览器优先渲染初始的HTML内容，让用户先看到内容，体验好。另外，js的执行如果涉及到DOM操作，也须等DOM解析完才行。